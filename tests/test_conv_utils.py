import sys
import os
cwd = os.getcwd()
sys.path.append(cwd)

import numpy as np
from glue.conv_utils import enu2lla, lla2enu

llapoints = np.array([
    [11.195706759810399, 48.08550232200912, 593.9179680865843, 104.0, 47.0, 35.0],
    [11.1963529598104,   48.08582262200912, 581.7479680865844, 99.0, 102.0, 106.0],
    [11.195886259810399, 48.08526722200912, 583.2079680865843, 50.0, 58.0, 34.0],
    [11.196453659810398, 48.08554332200912, 586.1579680865843, 248.0, 248.0, 248.0],
    [11.195737959810398, 48.08543712200912, 592.8979680865843, 158.0, 82.0, 63.0],
    [11.196205559810398, 48.08569732200912, 581.3879680865844, 177.0, 177.0, 173.0],
    [11.195892859810398, 48.08568072200912, 581.4479680865843, 173.0, 172.0, 171.0],
    [11.196046959810399, 48.08532262200912, 582.4179680865843, 225.0, 223.0, 206.0],
    [11.195736459810398, 48.08583202200912, 589.8379680865844, 216.0, 120.0, 79.0],
    [11.195739359810398, 48.08543672200912, 592.8779680865844, 201.0, 114.0, 80.0]
])

enupoints = np.array([
    [-36.285302786148215, -0.25256129729119614, -27.527716455674817, 104.0, 47.0, 35.0],
    [11.862242563969787, 35.365382812017565, -39.69772259797337, 99.0, 102.0, 106.0],
    [-22.911023911157272, -26.396258203158006, -38.237709185141235, 50.0, 58.0, 34.0],
    [19.365344634034436, 4.306647814500966, -35.2876442344773, 248.0, 248.0, 248.0],
    [-33.9606630688721, -7.502967598193981, -28.54770809337198, 158.0, 82.0, 63.0],
    [0.879724080598475, 21.431740761998682, -40.0576495450869, 177.0, 177.0, 173.0],
    [-22.419077984881216, 19.585829222096706, -39.997682868427866, 173.0, 172.0, 171.0],
    [-10.937398470378273, -20.235691329051832, -39.02765493110462, 225.0, 223.0, 206.0],
    [-34.072149392785384, 36.41081812659592, -31.607808310625977, 216.0, 120.0, 79.0],
    [-33.85635067113675, -7.547449123464524, -28.567707592095502, 201.0, 114.0, 80.0]
])

def test_lla2enu(mocker):

    
    T = np.array([
        4187814.29362,   
        828920.453163, 
        4723695.16181
    ])

    Rinv = np.array([
        [-0.19416918,  0.98096806,  0.        ],
        [-0.72998009, -0.14448956,  0.66802084],
        [ 0.6553071 ,  0.12970906,  0.74414257],
    ])
    
    Sinv = 1.0
    out = lla2enu(llapoints[:, :3], Rinv, Sinv, T)
    assert np.allclose(enupoints[:, :3], out)

def test_enu2lla():

    R = np.array([
        [-0.19416918, -0.72998009,  0.6553071 ], 
        [ 0.98096806, -0.14448956,  0.12970906],
        [ 0.        ,  0.66802084,  0.74414257],
    ])
    
    T = np.array([
        4187814.29362,
        828920.453163,
        4723695.16181
    ])

    S = 1.0
    
    out = enu2lla(enupoints[:, :3], R, S, T)
    assert np.allclose(llapoints[:, :3], out)
